# CrewPlanner — Project Status & Developer Guide

## Project Overview

**CrewPlanner** is a team management app for a sailing team (~10-20 members), replacing WhatsApp with structured event planning, availability tracking, task management, and team communication. All UI text is in Dutch.

**Live URL:** https://crew-planner.vercel.app

---

## Tech Stack

| Technology | Purpose |
|---|---|
| Next.js 16 (App Router) | Framework, server actions |
| TypeScript | Type safety |
| Prisma 7.4 + Neon | PostgreSQL ORM + serverless DB |
| Clerk | Authentication & user management |
| Resend | Transactional email |
| Vercel Blob | File storage (post attachments) |
| Tailwind CSS 4 + shadcn/ui | Styling & components |
| Zod | Form validation |
| Sonner | Toast notifications |
| web-push | Web Push notifications (VAPID) |
| Vercel AI SDK + @ai-sdk/anthropic | AI chat assistant (Claude tool use) |

---

## Environment Variables

| Variable | Where | Required | Notes |
|---|---|---|---|
| `DATABASE_URL` | `.env` | Yes | Neon Postgres connection string (set by Neon integration) |
| `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` | `.env.local` | Yes | Clerk public key |
| `CLERK_SECRET_KEY` | `.env.local` | Yes | Clerk server key |
| `BLOB_READ_WRITE_TOKEN` | `.env.local` | Yes | Vercel Blob token for file uploads |
| `RESEND_API_KEY` | `.env.local` + Vercel | Yes | Resend email API key |
| `NEXT_PUBLIC_APP_URL` | `.env.local` + Vercel | No | Defaults to `https://crew-planner.vercel.app` |
| `CRON_SECRET` | Vercel only | Auto | Auto-generated by Vercel for cron auth |
| `NEXT_PUBLIC_VAPID_PUBLIC_KEY` | `.env.local` + Vercel | Yes | VAPID public key for web push (safe to expose) |
| `VAPID_PRIVATE_KEY` | `.env.local` + Vercel | Yes | VAPID private key for web push (server only) |
| `ANTHROPIC_API_KEY` | `.env.local` + Vercel | Yes | Anthropic API key for AI chat assistant |

---

## Project Structure

```
prisma/schema.prisma          # Database schema (source of truth)
src/
├── app/
│   ├── (app)/                 # Authenticated app routes
│   │   ├── page.tsx           # Dashboard
│   │   ├── evenementen/       # Events: list, detail, create, edit
│   │   ├── informatie/        # Posts: list, detail, create, edit
│   │   ├── taken/             # Tasks: list, detail, create
│   │   ├── beheer/            # Admin: members, task groups, stats
│   │   ├── profiel/           # Self-edit profile page
│   │   └── inbox/             # Notifications
│   ├── (auth)/                # Sign-in / sign-up (Clerk)
│   └── api/
│       ├── upload/            # File upload (Vercel Blob)
│       ├── notifications/     # Notification count
│       ├── push/              # Push subscribe/unsubscribe endpoints
│       ├── calendar/[token]/  # iCal subscription endpoint (.ics feed)
│       ├── calendar/event/[id]/ # Single event .ics download (for email links)
│       ├── chat/             # AI chat API route (streamText + tools)
│       ├── cron/herinneringen/# Daily reminder cron job
│       └── cron/verjaardagen/ # Daily birthday notification cron job
├── components/
│   ├── events/                # EventForm, EventCard, EventCardActions, EventList, AvailabilityButtons, AvailabilityOverview, CalendarSubscribe
│   ├── posts/                 # PostForm, PostCard
│   ├── tasks/                 # TaskForm, TaskCard, TaskActions, TaskGroupManager
│   ├── comments/              # CommentForm, CommentThread
│   ├── dashboard/             # EventHero, PendingEvents, RecentPosts, OpenTasks
│   ├── admin/                 # TeamMemberList, AddMemberForm, StatsDashboard, MemberStatsTable
│   ├── profile/               # ProfileForm (self-edit profile)
│   ├── chat/                  # ChatOverlay (floating button + Sheet panel)
│   ├── shared/                # PageHeader, EmptyState, StatusBadge, UserAvatar, MemberPicker, SearchInput, ConfirmDialog
│   ├── layout/                # Header, Sidebar, BottomNav, NotificationBell, NotificationItem, PushToggle
│   └── ui/                    # shadcn/ui primitives
└── lib/
    ├── auth.ts                # getCurrentUserId, isAdmin, requireAdmin, getUserRole
    ├── prisma.ts              # Prisma client (Neon adapter)
    ├── users.ts               # resolveUsers / resolveUser (TeamLid first, Clerk fallback)
    ├── utils.ts               # cn, formatDatum, formatDatumKort, formatTijd, relatieveDatum
    ├── constants.ts           # Label/color maps for all enums
    ├── types.ts               # EventWithBeschikbaarheid, TaskWithGroup, ActionResult, etc.
    ├── email.ts               # Resend client (lazy init), FROM_EMAIL, APP_URL
    ├── push.ts                # web-push client (lazy init), sendPushToUsers()
    ├── ical.ts                # generateICalFeed() — iCal feed generation from events
    ├── ai/tools.ts            # AI tool definitions (createTools) — read & write tools for chat assistant
    ├── email-templates/       # HTML email templates (Dutch): nieuw-evenement, herinnering, taak-toegewezen, welkom
    ├── validations/           # Zod schemas: events, tasks, posts, users
    ├── actions/               # Server actions: events, posts, tasks, comments, notifications, emails, users, calendar
    └── queries/               # Data fetching: events, posts, tasks, comments, notifications, dashboard, stats, profile
```

---

## Database Models

| Model | Purpose |
|---|---|
| `Event` | Events with type, date, location, deadline |
| `Beschikbaarheid` | Per-user availability response per event |
| `EventUitnodiging` | Which users are invited to an event |
| `EventHerinnering` | Scheduled reminder config per event |
| `EventHerinneringLog` | Per-user reminder delivery log (event + user + timestamp) |
| `Post` | Information posts with categories |
| `PostFile` | File attachments on posts |
| `Comment` | Polymorphic comments on events/posts/tasks |
| `TaskGroup` | Grouping for tasks |
| `Task` | Tasks with status, assignment, claiming |
| `Notification` | In-app notifications |
| `PushSubscription` | Web push subscription per user (endpoint, VAPID keys) |
| `CalendarToken` | Per-user secret token for iCal subscription URL |
| `TeamLid` | Local member profile (address, birthday, team manager flag) |

---

## Key Patterns

- **Server Components** by default; `"use client"` only where needed (forms, interactivity)
- **Server Actions** for all mutations (`"use server"` in action files)
- **Form pattern**: `useActionState` + native `<form action={}>` + `FormData` + Zod validation
- **Auth**: `requireAdmin()` for admin-only actions, `getCurrentUserId()` for any user
- **Notifications**: `notifyMembers()`, `notifyAdmins()`, `notifySpecificUsers()` helpers
- **Email**: All email sends wrapped in try/catch with `RESEND_API_KEY` guard — failures never break the main action
- **Push**: `sendPushToUsers()` called alongside email in notification helpers — same try/catch pattern, expired subscriptions auto-cleaned
- **User resolution**: `resolveUsers()` queries `TeamLid` first, falls back to Clerk API for unknown IDs
- **TeamLid**: Local member profile data (address, birthday) — most Clerk `getUserList` calls replaced with TeamLid queries

---

## Phase 1 (Complete) — MVP

- Clerk authentication (Dutch localization)
- Events CRUD with availability tracking (3 states + mandatory reason)
- Information center (posts, categories, search, pinning, file attachments)
- Contextual comments on events, posts, and tasks
- Tasks with groups, claiming, completion
- Dashboard with next event hero, pending events, recent posts, open tasks
- Notification system (in-app)
- Admin page with team member role management + task group management
- Responsive design (mobile-first)

## Phase 2 (Complete) — Invitations, Email, Stats

### Event Invitations
- `EventUitnodiging` join table — admins select which members to invite per event
- `MemberPicker` component with select all/deselect all and individual member checkboxes
- Members only see events they're invited to; admins see all
- Response ratio based on invited count (not global member count)
- "Niet gereageerd" section shows non-responders on event detail

### Email Notifications (Resend)
- Event invite emails sent on event creation
- Task assignment emails sent when `toegewezenAan` is set
- Reminder emails sent via daily cron to non-responders
- Templates: `nieuw-evenement`, `herinnering`, `taak-toegewezen`
- Sending domain: configured in `src/lib/email.ts` (`FROM_EMAIL`)

### Automated Reminders
- `EventHerinnering` records created per event (configurable: 2/3/5/2+5 days after creation)
- Reminder timing changed from "days before deadline" to "days after event creation" (`dagenNaAanmaak`)
- Vercel cron at `/api/cron/herinneringen` runs daily at 08:00 UTC
- Sends email + in-app `HERINNERING` notification to non-responders
- Auth: `CRON_SECRET` header verification

### Per-User Reminder Tracking
- `EventHerinneringLog` model tracks which users received which reminders (per event, per user, with timestamp)
- Cron job creates a log entry for each user when a reminder is sent
- Event detail page shows bell icon with reminder count next to each user (both responders and non-responders)
- `AvailabilityOverview` component receives `herinneringLogs` prop and displays per-user counts
- `getEventById` query includes `herinneringLogs` relation

### Past/Upcoming Event Split
- Events page shows upcoming events by default
- Past events in collapsible "Afgelopen evenementen" section (muted styling)

### Task Assignment
- `<Select>` in task form to assign a member
- Assignee shown on task cards (avatar + name) and detail page
- `TAAK_TOEGEWEZEN` in-app notification + email on assignment

### Admin Stats Dashboard
- **Opkomst**: per member — invited, responded, beschikbaar, opkomst%
- **Afgeronde taken**: per member — completed task count
- **Responstijd**: per member — average hours to respond
- Located on Beheer page below team members and task groups

---

### End Time Simplification
- Event `eindtijd` field changed from full `datetime-local` input to `time` input only
- End time is stored as a full DateTime but only the time portion is used in the UI
- Event form uses `toTimeLocal()` helper to extract HH:MM from the stored DateTime

---

## Phase 3 (In Progress) — Push Notifications, Member Management & Polish

### Web Push Notifications (Complete)
- `web-push` package with VAPID authentication
- `PushSubscription` model stores per-user browser push subscriptions (endpoint, p256dh, auth)
- Service worker (`public/sw.js`) handles `push` and `notificationclick` events
- API routes: `POST /api/push/subscribe` (upsert) and `POST /api/push/unsubscribe` (delete)
- `PushToggle` component in header — registers SW, manages subscription, shows bell-ring/bell-off icon
- `sendPushToUsers()` helper (lazy init, same pattern as email) called in `notifyMembers`, `notifySpecificUsers`, `notifyAdmins`
- Expired subscriptions (HTTP 410/404) auto-deleted on send failure
- PWA manifest (`src/app/manifest.ts`) + app icons for iOS "Add to Home Screen" push support
- **Deploy note**: `NEXT_PUBLIC_VAPID_PUBLIC_KEY` and `VAPID_PRIVATE_KEY` must be set in Vercel env vars

### iCal Calendar Subscription (Complete)
- `CalendarToken` model — one UUID token per user (`userId` unique, `token` unique)
- `GET /api/calendar/[token].ics` — serves iCal feed for that user's invited events (upcoming + past 30 days)
- No auth on endpoint — the secret token in the URL acts as authentication
- `generateICalFeed()` helper in `src/lib/ical.ts` — produces valid iCal with VCALENDAR/VEVENT, line folding, text escaping, hourly refresh hint
- Server actions in `src/lib/actions/calendar.ts`:
  - `getOrCreateCalendarToken()` — returns existing or creates new token for current user
  - `regenerateCalendarToken()` — deletes old token, creates new one (security: invalidates leaked URLs)
- `CalendarSubscribe` client component (`src/components/events/calendar-subscribe.tsx`):
  - "Agenda" button on events page (visible to all users, next to "Nieuw evenement" for admins)
  - Dialog with subscription URL, copy-to-clipboard button, and "Link vernieuwen" option
- **Add to Calendar in emails**: Event invite emails include "Toevoegen aan agenda" button — downloads `.ics` file via `/api/calendar/event/[id]` (universal: works with Google Calendar, Outlook, Apple Calendar)
- Calendar apps (Google Calendar, Apple Calendar, Outlook) can subscribe via URL and auto-sync

### Admin Member Management (Complete)
- Admins can create new team members directly from the Beheer page (Clerk account created with `skipPasswordRequirement: true`)
- `AddMemberForm` component: voornaam, achternaam, email fields with Zod validation (`createMemberSchema`)
- `createTeamMember` server action: creates Clerk user, sets `role: "member"` metadata, handles duplicate email errors
- Welcome email (`welkom.ts` template): manually triggered per member via mail icon button (not auto-sent on creation)
- `sendWelcomeEmail` server action: fetches user from Clerk, sends welcome email with sign-in link and "Wachtwoord vergeten?" instructions
- Ban/unban toggle: `toggleUserBan` server action calls Clerk's `banUser`/`unbanUser` — prevents sign-in while preserving history
- Banned members shown with "Inactief" badge and `opacity-50` styling; reactivatable via `UserCheck` icon button
- Self-ban and self-role-removal prevented in server actions

### UI Polish (Complete)
- Card base component: softer border (`border-border/60`), `hover:shadow-md` transition moved to base Card
- Event card urgency borders toned down from `/50` to `/30` opacity
- Card list spacing increased to `flex flex-col gap-6` on events, informatie, taken pages
- Dashboard spacing increased to `gap-6` between hero card and content grid

### Untracked files (not committed)
- `scripts/seed-members.ts` — Seeds 14 team members (Clerk users + TeamLid records)
- `scripts/seed-events.ts` — Seeds 19 events (no invitations — add members via edit page when ready)
- `scripts/seed-reminders.ts` — Seeds `EventHerinneringLog` entries for existing events (testing tool)
- `scripts/inspect-events.ts` — Inspects events with invitations, responses, and reminder logs (debugging tool)
- `scripts/seed-test-scenario.ts` — Creates a full test event with invited users, varied responses, and reminder logs
- `screenshots/` — Screenshots from debugging/design sessions

---

## Phase 4 (Complete) — AI Assistant

### AI Chat Assistant (Complete)
- Vercel AI SDK v6 (`ai`, `@ai-sdk/anthropic`, `@ai-sdk/react`) with Claude Sonnet tool use
- `POST /api/chat` route: Clerk auth, in-memory rate limiting (50 messages/hour/user), `streamText` → `toUIMessageStreamResponse()`
- `convertToModelMessages()` converts UIMessages (parts format) to ModelMessages (content format) for `streamText`
- `createTools(userId, isAdmin)` in `src/lib/ai/tools.ts` — 16 tools total:
  - **Read tools** (12): `getUpcomingEvents`, `getEventDetails`, `getMyPendingEvents`, `getTasks`, `getTaskDetails`, `getPosts`, `getPostDetails`, `getComments`, `getTaskGroups`, `getTeamMembers`, `getMySummary`, `searchAll`, `getContributionStats`
  - **Write tools** (4): `setMyAvailability`, `claimTask`, `completeTask`, `addComment`
- `getTeamMembers` tool reads from TeamLid (not Clerk)
- Tools reuse existing queries (`queries/*.ts`) and server actions (`actions/*.ts`) directly
- Write tools construct `FormData` programmatically and call server actions — auth is automatic via Clerk cookies
- **Role-aware system prompt**: different instructions for team managers (team overview, stats, non-responders) vs team members (own pending events, reminders, open tasks)
- System prompt instructs markdown formatting (lists, bold) for structured responses
- `ChatOverlay` client component: floating button (bottom-right, above BottomNav on mobile) → Sheet panel with suggestion chips, message list, input
- Assistant messages rendered with `react-markdown` for proper list/bold/link formatting
- `useChat` from `@ai-sdk/react` manages messages and streaming
- Multi-step tool use via `stopWhen: stepCountIs(5)` — allows lookup → confirm → execute flows
- **Deploy note**: `ANTHROPIC_API_KEY` must be set in Vercel env vars

### Planned
- Season overviews / reports
- Advanced file management

---

## Phase 5 (Complete) — TeamLid Model, Profiles & Birthday Notifications

### TeamLid Model
- `TeamLid` model stores rich member profile data locally (address, birthday, team manager flag)
- `clerkUserId` links to Clerk for auth; `email` unique for lookup
- Fields: `voornaam`, `achternaam`, `email`, `straat`, `postcode`, `woonplaats`, `geboortedatum`, `isTeamManager`
- `resolveUsers()` queries TeamLid first, falls back to Clerk only for unknown IDs
- Most `clerkClient().users.getUserList()` calls replaced with `prisma.teamLid.findMany()` queries
- `getAllTeamLeden()` helper in `queries/profile.ts` for member pickers (events, tasks forms)
- `notifyMembers()` and `notifyAdmins()` use `TeamLid.isTeamManager` instead of Clerk metadata

### Profile Page (`/profiel`)
- Self-edit profile page accessible via User icon in header
- `ProfileForm` component: voornaam, achternaam, straat, postcode, woonplaats, geboortedatum
- Email shown as read-only (admin-only change)
- `updateProfile` server action: updates TeamLid + syncs name to Clerk

### Admin Member Editing
- Pencil icon on each member in TeamMemberList opens Sheet with full profile edit form
- `updateTeamMember` server action: updates TeamLid + syncs name/role to Clerk
- `AddMemberForm` extended with address, birthday, team manager fields
- `createTeamMember` now creates both Clerk user and TeamLid record

### Birthday Notifications
- `VERJAARDAG` added to `NotificationType` enum
- Vercel cron at `/api/cron/verjaardagen` runs daily at 06:00 UTC (08:00 CEST)
- Queries TeamLid for members whose birthday month/day matches today
- Creates `VERJAARDAG` notification for all other members + sends push
- `NotificationItem` shows Cake icon for birthday notifications, links to dashboard

### Data Seeding
- `scripts/seed-members.ts` — Seeds 14 team members (Clerk users + TeamLid records), no emails sent
- `scripts/seed-events.ts` — Seeds 19 events (no invitations, no reminders) — admins add members via edit page when ready to go live

---

## Phase 6 (Complete) — UX Improvements & Polish

### Event Card Admin Actions
- Edit (pencil) and delete (trash) buttons directly on event cards, visible to admins only
- `EventCardActions` client component with confirmation dialog for delete
- Buttons stop event propagation — clicking edit/delete doesn't navigate to event detail
- Edit/delete buttons removed from event detail page (`/evenementen/[id]`) — card actions are the only entry point

### Event List Search
- Client-side search input on events page, filters by title and location
- `EventList` client component wraps tabs + search, receives pre-fetched data from server
- No server round-trips — instant filtering as you type

### Event Edit Notifications
- `updateEvent` now detects newly added members and sends them notifications + invite emails
- Previously invited members are not re-notified
- Fix: deselecting all members no longer silently re-invites everyone (empty string vs undefined handling)

### MemberPicker Simplification
- Removed confusing "Alle leden" toggle button
- Member list always visible with "Selecteer alle" / "Deselecteer alle" at top
- Counter shows "X van Y" selected members

### Universal Calendar Links in Emails
- Replaced Google Calendar-only link with universal `.ics` file download
- New endpoint: `GET /api/calendar/event/[id]` serves single-event `.ics` file
- Works with Outlook, Apple Calendar, Google Calendar, and any other calendar app

### Chat UX Improvements
- Disabled auto-focus on mobile (< 640px) — suggestion chips stay visible when sheet opens
- Increased text size from `text-sm` to `text-base` for better outdoor readability
- Loading indicator: solid bouncing dots instead of barely-visible text dots
- Rate limit increased from 20 to 50 messages/hour/user
- Rate limit error shows meaningful Dutch message (inline + toast) instead of generic error

### Sign-up Disabled
- Sign-up link hidden on login page via Clerk `appearance.elements.footerAction` display none
- Members are created exclusively by admins on the Beheer page

### Inbox Icon
- Changed inbox notification icon from Bell to Mail to avoid confusion with push toggle bell

### Team Member Manual
- `docs/handleiding-teamlid.md` — Dutch user manual for team members
- Covers all member-facing features with placeholder markers for screenshots

---

## Known Gotchas

- **Prisma client caching after schema changes**: After adding a new model and running `db:push` + `db:generate`, the dev server must be fully restarted. The global Prisma client singleton (`globalForPrisma.prisma`) caches the old client without the new model, causing `Cannot read properties of undefined (reading 'findUnique')` errors. A hot reload is not enough — kill and restart `npm run dev`.
- **Tailwind `space-y` vs `flex gap`**: On list pages, `space-y-*` classes sometimes don't produce visible spacing. Use `flex flex-col gap-*` instead for reliable card spacing.
- **Email sending fails silently**: All email functions in `src/lib/actions/emails.ts` are wrapped in try/catch and return early if `RESEND_API_KEY` is not set (`if (!process.env.RESEND_API_KEY) return;`). Errors are only logged to `console.error`. If emails aren't arriving, check: (1) `RESEND_API_KEY` is set in Vercel env vars, (2) the sending domain (`skutsjeebenhaezer.nl`) is verified in Resend, (3) Vercel function logs for `console.error` output.
- **FROM_EMAIL casing**: The `FROM_EMAIL` in `src/lib/email.ts` must be lowercase (`info@skutsjeebenhaezer.nl`) to match the Resend verified domain.
- **Clerk login emails from `noreply@accounts.dev`**: This is the default Clerk development instance sender. To change it, upgrade to a Clerk production instance or configure a custom email domain in Clerk dashboard (paid feature).

---

## Development Commands

```bash
npm run dev          # Start dev server
npm run build        # Production build (includes prisma generate)
npm run lint         # ESLint
npm run db:generate  # Regenerate Prisma client
npm run db:push      # Push schema to DB (no migration history)
npm run db:migrate   # Create migration (dev)
npm run db:seed      # Seed database
```

---

## Deployment

- Push to `main` triggers automatic Vercel deployment
- Database schema changes: run `npx prisma db push` or deploy will use `prisma generate` in build script
- Cron jobs configured in `vercel.json`
- **Required Vercel env vars**: `RESEND_API_KEY`, `NEXT_PUBLIC_VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY`, `ANTHROPIC_API_KEY` — without `RESEND_API_KEY`, all email sending silently no-ops
- **Resend domain**: `skutsjeebenhaezer.nl` must be verified in Resend dashboard with DNS records (SPF/DKIM) for emails to send successfully

---

## Future: Productizing CrewPlanner

Currently CrewPlanner is a single-team app hosted on `crew-planner.vercel.app` with email sending via `info@skutsjeebenhaezer.nl`. Below is a comprehensive list of changes needed to turn this into a multi-team SaaS product.

### Infrastructure & Domain
- **Dedicated email domain**: Set up a product-level sending domain (e.g. `crewplanner.nl` or `mail.crewplanner.app`) with its own DNS/SPF/DKIM records in Resend. The current setup uses the team's own domain which wouldn't work for a multi-tenant product.
- **Product domain**: Register and configure `crewplanner.nl` or similar as the primary product domain.
- **Custom subdomains / white-label**: Each team could have their own subdomain (e.g. `ebenhaezer.crewplanner.nl`) via Vercel wildcard domains.

### Multi-Tenancy (Database)
- **`Team` model**: Central model with team name, slug (for subdomain), logo, settings, subscription tier, created date.
- **`TeamMembership` model**: Join table between users and teams (replaces current `TeamLid`), supporting role per team (admin, member). A user could be in multiple teams.
- **Scope all data to team**: Every model (`Event`, `Task`, `Post`, `Notification`, etc.) needs a `teamId` foreign key. All queries must filter by current team.
- **Team-scoped settings**: Reminder defaults, notification preferences, event types, email templates — configurable per team instead of hardcoded.
- **Data isolation**: Ensure users can only access data from teams they belong to. Middleware or query-level enforcement.

### Authentication & User Management
- **Clerk Organizations**: Use Clerk's Organizations feature for multi-team support instead of separate Clerk projects. Handles team invitations, role management, and team switching natively.
- **Team switching UI**: Header/sidebar selector to switch between teams for users in multiple teams.
- **Self-service team creation**: Landing page → sign up → create team → invite members flow.
- **Invitation flow**: Replace current admin-creates-Clerk-user approach with email invitation links that allow self-registration scoped to a team.

### Onboarding & Landing Page
- **Marketing site**: Public landing page explaining the product, pricing, features. Currently the entire app is behind auth.
- **Onboarding wizard**: Guide new team admins through setup: team name, logo, invite members, create first event.
- **Trial / freemium**: Time-limited trial or free tier with limited members/events.

### Billing & Subscriptions
- **Payment integration**: Stripe or similar for subscription billing.
- **Pricing tiers**: e.g. Free (up to 10 members), Pro (unlimited members, AI assistant), Enterprise (white-label, priority support).
- **Usage limits**: Enforce limits on members, events, AI messages, file storage per tier.
- **Billing dashboard**: Team admins can manage subscription, view invoices, update payment method.

### AI Assistant
- **Per-team cost tracking**: Track AI API usage per team for billing purposes.
- **Configurable rate limits**: Different limits per subscription tier instead of global 50/hour.
- **Team-scoped tools**: AI tools must respect team boundaries — only access data from the current team.

### Email & Notifications
- **Dynamic FROM_EMAIL**: Send from `teamslug@mail.crewplanner.app` or a generic `noreply@crewplanner.app` instead of a team-specific domain.
- **Email templates**: Allow teams to customize email content, branding, colors.
- **Unsubscribe handling**: Per-user email preferences with one-click unsubscribe (required for compliance at scale).

### Customization & Branding
- **Team logo & colors**: Stored on Team model, applied to header, emails, PWA manifest.
- **Custom event types**: Let teams define their own event types instead of hardcoded WEDSTRIJD/TRAINING/ONDERHOUD/SOCIAAL.
- **Custom task categories**: Same for task groups.
- **Language support**: Currently all Dutch — add i18n framework (e.g. `next-intl`) for multi-language support.

### Admin & Operations
- **Super-admin dashboard**: Platform-level admin panel to manage all teams, view usage, handle support.
- **Analytics**: Team usage metrics, active users, retention — for product decisions.
- **Audit logging**: Track who did what, when — important for larger teams and compliance.
- **Data export**: Allow team admins to export their data (GDPR compliance).
- **Team deletion**: Clean removal of all team data when a team leaves.

### Technical Scaling
- **Database**: Move from single Neon DB to connection pooling or per-team database isolation for large scale.
- **Caching**: Add Redis for frequently accessed data (team settings, user sessions) instead of hitting DB on every request.
- **Background jobs**: Move email sending, push notifications, and cron jobs to a proper job queue (e.g. Inngest, Trigger.dev) instead of Vercel cron + inline sends.
- **File storage**: Per-team storage quotas on Vercel Blob.
- **Rate limiting**: Move from in-memory to Redis-based rate limiting (in-memory resets on serverless cold starts).
